var pt=Object.defineProperty;var mt=(i,s,a)=>s in i?pt(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a;var yt=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports);var Y=(i,s,a)=>(mt(i,typeof s!="symbol"?s+"":s,a),a);var zt=yt((Ie,ue)=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&h(v)}).observe(document,{childList:!0,subtree:!0});function a(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerpolicy&&(p.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?p.credentials="include":l.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function h(l){if(l.ep)return;l.ep=!0;const p=a(l);fetch(l.href,p)}})();class je{constructor(){}rerender(){const s=this.render();this.element.replaceWith(s),this.element=s}}class q{constructor(){}rerender(){this.element.replaceWith(this.create())}}class vt extends q{constructor(s,{size:a}){super(),this.game=s,this.size=a,this.game.socket.on("game-joined",h=>{history.replaceState(null,"",h.id),this.game.playerId=h.player.id,this.rerender()}),this.game.socket.on("word-list",h=>{this.game.words.add(h),this.rerender()}),this.game.socket.on("card-revealed",h=>{const l=this.game.words.get(h.word);l.revealed=!0,l.team=h.team,this.game.clueRemainder=h.clueRemainder,this.rerender()})}create(){this.element=document.createElement("div"),this.element.id="board";const s=Array.from({length:this.size**2},(a,h)=>{const l=this.game.words?this.game.words.at(h):{},p=document.createElement("div");p.className="card",p.style.cursor="pointer",l&&"revealed"in l&&p.classList.add("reversed"),this.game.reversedCards.includes(h)&&p.classList.add("reversed"),this.game.selectedCards.includes(h)&&p.classList.add("selected"),l&&[0,1,-1,null].includes(l.team)&&p.classList.add(l.team===0?"first-team":l.team===1?"second-team":l.team===-1?"death":"default"),p.onclick=()=>{if(this.game.turn.team===this.game.player.team)if(this.game.turn.role===this.game.player.role&&this.game.player.role===1){if(!p.classList.contains(this.game.team?"second-team":"first-team"))return;this.game.emit("select-card",{target:h,selected:!p.classList.contains("selected")})}else this.game.turn.role===this.game.player.role&&this.game.player.role===0&&this.game.emit("reveal-card",{word:l.id})};const v=document.createElement("span");return v.textContent=this.game.words.size?l.name:"???",p.appendChild(v),p});return this.element.append(...s),this.element}}var J=Object.defineProperty,gt=Object.getOwnPropertyDescriptor,bt=Object.getOwnPropertyNames,kt=Object.prototype.hasOwnProperty,wt=(i,s)=>J(i,"name",{value:s,configurable:!0}),Et=(i,s)=>{for(var a in s)J(i,a,{get:s[a],enumerable:!0})},Ct=(i,s,a,h)=>{if(s&&typeof s=="object"||typeof s=="function")for(let l of bt(s))kt.call(i,l)||l===a||J(i,l,{get:()=>s[l],enumerable:!(h=gt(s,l))||h.enumerable});return i},_t=i=>Ct(J({},"__esModule",{value:!0}),i),Be={};Et(Be,{Collection:()=>B,version:()=>At}),_t(Be);var B=class extends Map{ensure(i,s){if(this.has(i))return this.get(i);if(typeof s!="function")throw new TypeError(`${s} is not a function`);const a=s(i,this);return this.set(i,a),a}hasAll(...i){return i.every(s=>super.has(s))}hasAny(...i){return i.some(s=>super.has(s))}first(i){if(i===void 0)return this.values().next().value;if(i<0)return this.last(-1*i);i=Math.min(this.size,i);const s=this.values();return Array.from({length:i},()=>s.next().value)}firstKey(i){if(i===void 0)return this.keys().next().value;if(i<0)return this.lastKey(-1*i);i=Math.min(this.size,i);const s=this.keys();return Array.from({length:i},()=>s.next().value)}last(i){const s=[...this.values()];return i===void 0?s[s.length-1]:i<0?this.first(-1*i):i?s.slice(-i):[]}lastKey(i){const s=[...this.keys()];return i===void 0?s[s.length-1]:i<0?this.firstKey(-1*i):i?s.slice(-i):[]}at(i){return i=Math.floor(i),[...this.values()].at(i)}keyAt(i){return i=Math.floor(i),[...this.keys()].at(i)}random(i){const s=[...this.values()];return i===void 0?s[Math.floor(Math.random()*s.length)]:s.length&&i?Array.from({length:Math.min(i,s.length)},()=>s.splice(Math.floor(Math.random()*s.length),1)[0]):[]}randomKey(i){const s=[...this.keys()];return i===void 0?s[Math.floor(Math.random()*s.length)]:s.length&&i?Array.from({length:Math.min(i,s.length)},()=>s.splice(Math.floor(Math.random()*s.length),1)[0]):[]}reverse(){const i=[...this.entries()].reverse();this.clear();for(const[s,a]of i)this.set(s,a);return this}find(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));for(const[a,h]of this)if(i(h,a,this))return h}findKey(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));for(const[a,h]of this)if(i(h,a,this))return a}sweep(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));const a=this.size;for(const[h,l]of this)i(l,h,this)&&this.delete(h);return a-this.size}filter(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));const a=new this.constructor[Symbol.species];for(const[h,l]of this)i(l,h,this)&&a.set(h,l);return a}partition(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));const a=[new this.constructor[Symbol.species],new this.constructor[Symbol.species]];for(const[h,l]of this)i(l,h,this)?a[0].set(h,l):a[1].set(h,l);return a}flatMap(i,s){const a=this.map(i,s);return new this.constructor[Symbol.species]().concat(...a)}map(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));const a=this.entries();return Array.from({length:this.size},()=>{const[h,l]=a.next().value;return i(l,h,this)})}mapValues(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));const a=new this.constructor[Symbol.species];for(const[h,l]of this)a.set(h,i(l,h,this));return a}some(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));for(const[a,h]of this)if(i(h,a,this))return!0;return!1}every(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));for(const[a,h]of this)if(!i(h,a,this))return!1;return!0}reduce(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);let a;if(s!==void 0){a=s;for(const[l,p]of this)a=i(a,p,l,this);return a}let h=!0;for(const[l,p]of this)h?(a=p,h=!1):a=i(a,p,l,this);if(h)throw new TypeError("Reduce of empty collection with no initial value");return a}each(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);s!==void 0&&(i=i.bind(s));for(const[a,h]of this)i(h,a,this);return this}tap(i,s){if(typeof i!="function")throw new TypeError(`${i} is not a function`);return s!==void 0&&(i=i.bind(s)),i(this),this}clone(){return new this.constructor[Symbol.species](this)}concat(...i){const s=this.clone();for(const a of i)for(const[h,l]of a)s.set(h,l);return s}equals(i){if(!i)return!1;if(this===i)return!0;if(this.size!==i.size)return!1;for(const[s,a]of this)if(!i.has(s)||a!==i.get(s))return!1;return!0}sort(i=B.defaultSort){const s=[...this.entries()];s.sort((a,h)=>i(a[1],h[1],a[0],h[0])),super.clear();for(const[a,h]of s)super.set(a,h);return this}intersect(i){const s=new this.constructor[Symbol.species];for(const[a,h]of i)this.has(a)&&Object.is(h,this.get(a))&&s.set(a,h);return s}subtract(i){const s=new this.constructor[Symbol.species];for(const[a,h]of this)i.has(a)&&Object.is(h,i.get(a))||s.set(a,h);return s}difference(i){const s=new this.constructor[Symbol.species];for(const[a,h]of i)this.has(a)||s.set(a,h);for(const[a,h]of this)i.has(a)||s.set(a,h);return s}merge(i,s,a,h){const l=new this.constructor[Symbol.species],p=new Set([...this.keys(),...i.keys()]);for(const v of p){const E=this.has(v),_=i.has(v);if(E&&_){const k=h(this.get(v),i.get(v),v);k.keep&&l.set(v,k.value)}else if(E){const k=s(this.get(v),v);k.keep&&l.set(v,k.value)}else if(_){const k=a(i.get(v),v);k.keep&&l.set(v,k.value)}}return l}sorted(i=B.defaultSort){return new this.constructor[Symbol.species](this).sort((s,a,h,l)=>i(s,a,h,l))}toJSON(){return[...this.values()]}static defaultSort(i,s){return Number(i>s)||Number(i===s)-1}static combineEntries(i,s){const a=new B;for(const[h,l]of i)a.has(h)?a.set(h,s(a.get(h),l,h)):a.set(h,l);return a}};wt(B,"Collection");var At="1.5.1";/*!
 * Socket.IO v4.7.1
 * (c) 2014-2023 Guillermo Rauch
 * Released under the MIT License.
 */(function(i,s){typeof Ie=="object"&&typeof ue<"u"?ue.exports=s():typeof define=="function"&&define.amd?define(s):(i=typeof globalThis<"u"?globalThis:i||self).io=s()})(globalThis,function(){function i(n){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},i(n)}function s(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function a(n,c){for(var o=0;o<c.length;o++){var e=c[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,(t=e.key,r=void 0,typeof(r=function(u,f){if(typeof u!="object"||u===null)return u;var d=u[Symbol.toPrimitive];if(d!==void 0){var m=d.call(u,f||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(u)}(t,"string"))=="symbol"?r:String(r)),e)}var t,r}function h(n,c,o){return c&&a(n.prototype,c),o&&a(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n}function l(){return l=Object.assign?Object.assign.bind():function(n){for(var c=1;c<arguments.length;c++){var o=arguments[c];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(n[e]=o[e])}return n},l.apply(this,arguments)}function p(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),c&&E(n,c)}function v(n){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},v(n)}function E(n,c){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,e){return o.__proto__=e,o},E(n,c)}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(n,c,o){return k=_()?Reflect.construct.bind():function(e,t,r){var u=[null];u.push.apply(u,t);var f=new(Function.bind.apply(e,u));return r&&E(f,r.prototype),f},k.apply(null,arguments)}function T(n){var c=typeof Map=="function"?new Map:void 0;return T=function(o){if(o===null||(e=o,Function.toString.call(e).indexOf("[native code]")===-1))return o;var e;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(o))return c.get(o);c.set(o,t)}function t(){return k(o,arguments,v(this).constructor)}return t.prototype=Object.create(o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),E(t,o)},T(n)}function A(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function O(n){var c=_();return function(){var o,e=v(n);if(c){var t=v(this).constructor;o=Reflect.construct(e,arguments,t)}else o=e.apply(this,arguments);return function(r,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A(r)}(this,o)}}function S(){return S=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,c,o){var e=function(r,u){for(;!Object.prototype.hasOwnProperty.call(r,u)&&(r=v(r))!==null;);return r}(n,c);if(e){var t=Object.getOwnPropertyDescriptor(e,c);return t.get?t.get.call(arguments.length<3?n:o):t.value}},S.apply(this,arguments)}function he(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,e=new Array(c);o<c;o++)e[o]=n[o];return e}function le(n,c){var o=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=function(d,m){if(d){if(typeof d=="string")return he(d,m);var y=Object.prototype.toString.call(d).slice(8,-1);return y==="Object"&&d.constructor&&(y=d.constructor.name),y==="Map"||y==="Set"?Array.from(d):y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y)?he(d,m):void 0}}(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var e=0,t=function(){};return{s:t,n:function(){return e>=n.length?{done:!0}:{done:!1,value:n[e++]}},e:function(d){throw d},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,u=!0,f=!1;return{s:function(){o=o.call(n)},n:function(){var d=o.next();return u=d.done,d},e:function(d){f=!0,r=d},f:function(){try{u||o.return==null||o.return()}finally{if(f)throw r}}}}var N=Object.create(null);N.open="0",N.close="1",N.ping="2",N.pong="3",N.message="4",N.upgrade="5",N.noop="6";var F=Object.create(null);Object.keys(N).forEach(function(n){F[N[n]]=n});var Q,Ue={type:"error",data:"parser error"},fe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",de=typeof ArrayBuffer=="function",pe=function(n){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer},X=function(n,c,o){var e=n.type,t=n.data;return fe&&t instanceof Blob?c?o(t):me(t,o):de&&(t instanceof ArrayBuffer||pe(t))?c?o(t):me(new Blob([t]),o):o(N[e]+(t||""))},me=function(n,c){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];c("b"+(e||""))},o.readAsDataURL(n)};function ye(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}for(var De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=typeof Uint8Array>"u"?[]:new Uint8Array(256),z=0;z<64;z++)U[De.charCodeAt(z)]=z;var Z,Fe=typeof ArrayBuffer=="function",G=function(n,c){if(typeof n!="string")return{type:"message",data:ve(n,c)};var o=n.charAt(0);return o==="b"?{type:"message",data:ze(n.substring(1),c)}:F[o]?n.length>1?{type:F[o],data:n.substring(1)}:{type:F[o]}:Ue},ze=function(n,c){if(Fe){var o=function(e){var t,r,u,f,d,m=.75*e.length,y=e.length,g=0;e[e.length-1]==="="&&(m--,e[e.length-2]==="="&&m--);var w=new ArrayBuffer(m),L=new Uint8Array(w);for(t=0;t<y;t+=4)r=U[e.charCodeAt(t)],u=U[e.charCodeAt(t+1)],f=U[e.charCodeAt(t+2)],d=U[e.charCodeAt(t+3)],L[g++]=r<<2|u>>4,L[g++]=(15&u)<<4|f>>2,L[g++]=(3&f)<<6|63&d;return w}(n);return ve(o,c)}return{base64:!0,data:n}},ve=function(n,c){return c==="blob"?n instanceof Blob?n:new Blob([n]):n instanceof ArrayBuffer?n:n.buffer},ge=String.fromCharCode(30);function C(n){if(n)return function(c){for(var o in C.prototype)c[o]=C.prototype[o];return c}(n)}C.prototype.on=C.prototype.addEventListener=function(n,c){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(c),this},C.prototype.once=function(n,c){function o(){this.off(n,o),c.apply(this,arguments)}return o.fn=c,this.on(n,o),this},C.prototype.off=C.prototype.removeListener=C.prototype.removeAllListeners=C.prototype.removeEventListener=function(n,c){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var o,e=this._callbacks["$"+n];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var t=0;t<e.length;t++)if((o=e[t])===c||o.fn===c){e.splice(t,1);break}return e.length===0&&delete this._callbacks["$"+n],this},C.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var c=new Array(arguments.length-1),o=this._callbacks["$"+n],e=1;e<arguments.length;e++)c[e-1]=arguments[e];if(o){e=0;for(var t=(o=o.slice(0)).length;e<t;++e)o[e].apply(this,c)}return this},C.prototype.emitReserved=C.prototype.emit,C.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},C.prototype.hasListeners=function(n){return!!this.listeners(n).length};var x=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function be(n){for(var c=arguments.length,o=new Array(c>1?c-1:0),e=1;e<c;e++)o[e-1]=arguments[e];return o.reduce(function(t,r){return n.hasOwnProperty(r)&&(t[r]=n[r]),t},{})}var $e=x.setTimeout,Ve=x.clearTimeout;function $(n,c){c.useNativeTimers?(n.setTimeoutFn=$e.bind(x),n.clearTimeoutFn=Ve.bind(x)):(n.setTimeoutFn=x.setTimeout.bind(x),n.clearTimeoutFn=x.clearTimeout.bind(x))}var ke,We=function(n){p(o,n);var c=O(o);function o(e,t,r){var u;return s(this,o),(u=c.call(this,e)).description=t,u.context=r,u.type="TransportError",u}return h(o)}(T(Error)),ee=function(n){p(o,n);var c=O(o);function o(e){var t;return s(this,o),(t=c.call(this)).writable=!1,$(A(t),e),t.opts=e,t.query=e.query,t.socket=e.socket,t}return h(o,[{key:"onError",value:function(e,t,r){return S(v(o.prototype),"emitReserved",this).call(this,"error",new We(e,t,r)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return this.readyState!=="opening"&&this.readyState!=="open"||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){this.readyState==="open"&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,S(v(o.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=G(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){S(v(o.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",S(v(o.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(r){var u="";for(var f in r)r.hasOwnProperty(f)&&(u.length&&(u+="&"),u+=encodeURIComponent(f)+"="+encodeURIComponent(r[f]));return u}(e);return t.length?"?"+t:""}}]),o}(C),we="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),te=64,Ke={},Ee=0,V=0;function Ce(n){var c="";do c=we[n%te]+c,n=Math.floor(n/te);while(n>0);return c}function _e(){var n=Ce(+new Date);return n!==ke?(Ee=0,ke=n):n+"."+Ce(Ee++)}for(;V<te;V++)Ke[we[V]]=V;var Ae=!1;try{Ae=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var He=Ae;function Oe(n){var c=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!c||He))return new XMLHttpRequest}catch{}if(!c)try{return new x[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Ye(){}var Je=new Oe({xdomain:!1}).responseType!=null,Qe=function(n){p(o,n);var c=O(o);function o(e){var t;if(s(this,o),(t=c.call(this,e)).polling=!1,typeof location<"u"){var r=location.protocol==="https:",u=location.port;u||(u=r?"443":"80"),t.xd=typeof location<"u"&&e.hostname!==location.hostname||u!==e.port}var f=e&&e.forceBase64;return t.supportsBinary=Je&&!f,t.opts.withCredentials&&(t.cookieJar=void 0),t}return h(o,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var r=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var u=0;this.polling&&(u++,this.once("pollComplete",function(){--u||r()})),this.writable||(u++,this.once("drain",function(){--u||r()}))}else r()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(r,u){for(var f=r.split(ge),d=[],m=0;m<f.length;m++){var y=G(f[m],u);if(d.push(y),y.type==="error")break}return d})(e,this.socket.binaryType).forEach(function(r){if(t.readyState==="opening"&&r.type==="open"&&t.onOpen(),r.type==="close")return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(r)}),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(r,u){var f=r.length,d=new Array(f),m=0;r.forEach(function(y,g){X(y,!1,function(w){d[g]=w,++m===f&&u(d.join(ge))})})}(e,function(r){t.doWrite(r,function(){t.writable=!0,t.emitReserved("drain")})})}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=_e()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new M(this.uri(),e)}},{key:"doWrite",value:function(e,t){var r=this,u=this.request({method:"POST",data:e});u.on("success",t),u.on("error",function(f,d){r.onError("xhr post error",f,d)})}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",function(r,u){e.onError("xhr poll error",r,u)}),this.pollXhr=t}}]),o}(ee),M=function(n){p(o,n);var c=O(o);function o(e,t){var r;return s(this,o),$(A(r=c.call(this)),t),r.opts=t,r.method=t.method||"GET",r.uri=e,r.data=t.data!==void 0?t.data:null,r.create(),r}return h(o,[{key:"create",value:function(){var e,t=this,r=be(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;var u=this.xhr=new Oe(r);try{u.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var f in u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(f)&&u.setRequestHeader(f,this.opts.extraHeaders[f])}catch{}if(this.method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(u),"withCredentials"in u&&(u.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(u.timeout=this.opts.requestTimeout),u.onreadystatechange=function(){var d;u.readyState===3&&((d=t.opts.cookieJar)===null||d===void 0||d.parseCookies(u)),u.readyState===4&&(u.status===200||u.status===1223?t.onLoad():t.setTimeoutFn(function(){t.onError(typeof u.status=="number"?u.status:0)},0))},u.send(this.data)}catch(d){return void this.setTimeoutFn(function(){t.onError(d)},0)}typeof document<"u"&&(this.index=o.requestsCount++,o.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(this.xhr!==void 0&&this.xhr!==null){if(this.xhr.onreadystatechange=Ye,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete o.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),o}(C);M.requestsCount=0,M.requests={},typeof document<"u"&&(typeof attachEvent=="function"?attachEvent("onunload",Te):typeof addEventListener=="function"&&addEventListener("onpagehide"in x?"pagehide":"unload",Te,!1));function Te(){for(var n in M.requests)M.requests.hasOwnProperty(n)&&M.requests[n].abort()}var ne=typeof Promise=="function"&&typeof Promise.resolve=="function"?function(n){return Promise.resolve().then(n)}:function(n,c){return c(n,0)},W=x.WebSocket||x.MozWebSocket,xe=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Xe=function(n){p(o,n);var c=O(o);function o(e){var t;return s(this,o),(t=c.call(this,e)).supportsBinary=!e.forceBase64,t}return h(o,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,r=xe?{}:be(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=xe?new W(e,t,r):t?new W(e,t):new W(e)}catch(u){return this.emitReserved("error",u)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var f=e[u],d=u===e.length-1;X(f,t.supportsBinary,function(m){try{t.ws.send(m)}catch{}d&&ne(function(){t.writable=!0,t.emitReserved("drain")},t.setTimeoutFn)})},u=0;u<e.length;u++)r()}},{key:"doClose",value:function(){this.ws!==void 0&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=_e()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!W}}]),o}(ee),Ze=function(n){p(o,n);var c=O(o);function o(){return s(this,o),c.apply(this,arguments)}return h(o,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(function(){e.onClose()}).catch(function(t){e.onError("webtransport error",t)}),this.transport.ready.then(function(){e.transport.createBidirectionalStream().then(function(t){var r,u=t.readable.getReader();e.writer=t.writable.getWriter(),function d(){u.read().then(function(m){var y=m.done,g=m.value;y||(r||g.byteLength!==1||g[0]!==54?(e.onPacket(function(w,L,P){Z||(Z=new TextDecoder);var j=L||w[0]<48||w[0]>54;return G(j?w:Z.decode(w),P)}(g,r,"arraybuffer")),r=!1):r=!0,d())}).catch(function(m){})}();var f=e.query.sid?'0{"sid":"'.concat(e.query.sid,'"}'):"0";e.writer.write(new TextEncoder().encode(f)).then(function(){return e.onOpen()})})}))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var f=e[u],d=u===e.length-1;(function(m,y){fe&&m.data instanceof Blob?m.data.arrayBuffer().then(ye).then(y):de&&(m.data instanceof ArrayBuffer||pe(m.data))?y(ye(m.data)):X(m,!1,function(g){Q||(Q=new TextEncoder),y(Q.encode(g))})})(f,function(m){(function(y,g){return y.type==="message"&&typeof y.data!="string"&&g[0]>=48&&g[0]<=54})(f,m)&&t.writer.write(Uint8Array.of(54)),t.writer.write(m).then(function(){d&&ne(function(){t.writable=!0,t.emitReserved("drain")},t.setTimeoutFn)})})},u=0;u<e.length;u++)r()}},{key:"doClose",value:function(){var e;(e=this.transport)===null||e===void 0||e.close()}}]),o}(ee),Ge={websocket:Xe,webtransport:Ze,polling:Qe},et=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,tt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function re(n){var c=n,o=n.indexOf("["),e=n.indexOf("]");o!=-1&&e!=-1&&(n=n.substring(0,o)+n.substring(o,e).replace(/:/g,";")+n.substring(e,n.length));for(var t,r,u=et.exec(n||""),f={},d=14;d--;)f[tt[d]]=u[d]||"";return o!=-1&&e!=-1&&(f.source=c,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=function(m,y){var g=/\/{2,9}/g,w=y.replace(g,"/").split("/");return y.slice(0,1)!="/"&&y.length!==0||w.splice(0,1),y.slice(-1)=="/"&&w.splice(w.length-1,1),w}(0,f.path),f.queryKey=(t=f.query,r={},t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(m,y,g){y&&(r[y]=g)}),r),f}var se=function(n){p(o,n);var c=O(o);function o(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return s(this,o),(t=c.call(this)).writeBuffer=[],e&&i(e)==="object"&&(r=e,e=null),e?(e=re(e),r.hostname=e.host,r.secure=e.protocol==="https"||e.protocol==="wss",r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=re(r.host).host),$(A(t),r),t.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=t.secure?"443":"80"),t.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),t.port=r.port||(typeof location<"u"&&location.port?location.port:t.secure?"443":"80"),t.transports=r.transports||["polling","websocket","webtransport"],t.writeBuffer=[],t.prevBufferLen=0,t.opts=l({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),t.opts.path=t.opts.path.replace(/\/$/,"")+(t.opts.addTrailingSlash?"/":""),typeof t.opts.query=="string"&&(t.opts.query=function(u){for(var f={},d=u.split("&"),m=0,y=d.length;m<y;m++){var g=d[m].split("=");f[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return f}(t.opts.query)),t.id=null,t.upgrades=null,t.pingInterval=null,t.pingTimeout=null,t.pingTimeoutTimer=null,typeof addEventListener=="function"&&(t.opts.closeOnBeforeunload&&(t.beforeunloadEventListener=function(){t.transport&&(t.transport.removeAllListeners(),t.transport.close())},addEventListener("beforeunload",t.beforeunloadEventListener,!1)),t.hostname!=="localhost"&&(t.offlineEventListener=function(){t.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",t.offlineEventListener,!1))),t.open(),t}return h(o,[{key:"createTransport",value:function(e){var t=l({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var r=l({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Ge[e](r)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&o.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else{if(this.transports.length===0)return void this.setTimeoutFn(function(){t.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",function(r){return t.onClose("transport close",r)})}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),u=!1;o.priorWebsocketSuccess=!1;var f=function(){u||(r.send([{type:"ping",data:"probe"}]),r.once("packet",function(P){if(!u)if(P.type==="pong"&&P.data==="probe"){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;o.priorWebsocketSuccess=r.name==="websocket",t.transport.pause(function(){u||t.readyState!=="closed"&&(L(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())})}else{var j=new Error("probe error");j.transport=r.name,t.emitReserved("upgradeError",j)}}))};function d(){u||(u=!0,L(),r.close(),r=null)}var m=function(P){var j=new Error("probe error: "+P);j.transport=r.name,d(),t.emitReserved("upgradeError",j)};function y(){m("transport closed")}function g(){m("socket closed")}function w(P){r&&P.name!==r.name&&d()}var L=function(){r.removeListener("open",f),r.removeListener("error",m),r.removeListener("close",y),t.off("close",g),t.off("upgrading",w)};r.once("open",f),r.once("error",m),r.once("close",y),this.once("close",g),this.once("upgrading",w),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(function(){u||r.open()},200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",o.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(function(){e.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,r=0;r<this.writeBuffer.length;r++){var u=this.writeBuffer[r].data;if(u&&(t+=typeof(e=u)=="string"?function(f){for(var d=0,m=0,y=0,g=f.length;y<g;y++)(d=f.charCodeAt(y))<128?m+=1:d<2048?m+=2:d<55296||d>=57344?m+=3:(y++,m+=4);return m}(e):Math.ceil(1.33*(e.byteLength||e.size))),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"send",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"sendPacket",value:function(e,t,r,u){if(typeof t=="function"&&(u=t,t=void 0),typeof r=="function"&&(u=r,r=null),this.readyState!=="closing"&&this.readyState!=="closed"){(r=r||{}).compress=r.compress!==!1;var f={type:e,data:t,options:r};this.emitReserved("packetCreate",f),this.writeBuffer.push(f),u&&this.once("flush",u),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},r=function f(){e.off("upgrade",f),e.off("upgradeError",f),t()},u=function(){e.once("upgrade",r),e.once("upgradeError",r)};return this.readyState!=="opening"&&this.readyState!=="open"||(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){e.upgrading?u():t()}):this.upgrading?u():t()),this}},{key:"onError",value:function(e){o.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){this.readyState!=="opening"&&this.readyState!=="open"&&this.readyState!=="closing"||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],r=0,u=e.length;r<u;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}]),o}(C);se.protocol=4,se.protocol;var nt=typeof ArrayBuffer=="function",rt=function(n){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer},Re=Object.prototype.toString,st=typeof Blob=="function"||typeof Blob<"u"&&Re.call(Blob)==="[object BlobConstructor]",it=typeof File=="function"||typeof File<"u"&&Re.call(File)==="[object FileConstructor]";function ie(n){return nt&&(n instanceof ArrayBuffer||rt(n))||st&&n instanceof Blob||it&&n instanceof File}function K(n,c){if(!n||i(n)!=="object")return!1;if(Array.isArray(n)){for(var o=0,e=n.length;o<e;o++)if(K(n[o]))return!0;return!1}if(ie(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return K(n.toJSON(),!0);for(var t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&K(n[t]))return!0;return!1}function ot(n){var c=[],o=n.data,e=n;return e.data=oe(o,c),e.attachments=c.length,{packet:e,buffers:c}}function oe(n,c){if(!n)return n;if(ie(n)){var o={_placeholder:!0,num:c.length};return c.push(n),o}if(Array.isArray(n)){for(var e=new Array(n.length),t=0;t<n.length;t++)e[t]=oe(n[t],c);return e}if(i(n)==="object"&&!(n instanceof Date)){var r={};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(r[u]=oe(n[u],c));return r}return n}function at(n,c){return n.data=ae(n.data,c),delete n.attachments,n}function ae(n,c){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<c.length)return c[n.num];throw new Error("illegal attachments")}if(Array.isArray(n))for(var o=0;o<n.length;o++)n[o]=ae(n[o],c);else if(i(n)==="object")for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=ae(n[e],c));return n}var b,ct=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(b||(b={}));var ut=function(){function n(c){s(this,n),this.replacer=c}return h(n,[{key:"encode",value:function(c){return c.type!==b.EVENT&&c.type!==b.ACK||!K(c)?[this.encodeAsString(c)]:this.encodeAsBinary({type:c.type===b.EVENT?b.BINARY_EVENT:b.BINARY_ACK,nsp:c.nsp,data:c.data,id:c.id})}},{key:"encodeAsString",value:function(c){var o=""+c.type;return c.type!==b.BINARY_EVENT&&c.type!==b.BINARY_ACK||(o+=c.attachments+"-"),c.nsp&&c.nsp!=="/"&&(o+=c.nsp+","),c.id!=null&&(o+=c.id),c.data!=null&&(o+=JSON.stringify(c.data,this.replacer)),o}},{key:"encodeAsBinary",value:function(c){var o=ot(c),e=this.encodeAsString(o.packet),t=o.buffers;return t.unshift(e),t}}]),n}();function Se(n){return Object.prototype.toString.call(n)==="[object Object]"}var ht=function(n){p(o,n);var c=O(o);function o(e){var t;return s(this,o),(t=c.call(this)).reviver=e,t}return h(o,[{key:"add",value:function(e){var t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===b.BINARY_EVENT;r||t.type===b.BINARY_ACK?(t.type=r?b.EVENT:b.ACK,this.reconstructor=new lt(t),t.attachments===0&&S(v(o.prototype),"emitReserved",this).call(this,"decoded",t)):S(v(o.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!ie(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,S(v(o.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(b[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===b.BINARY_EVENT||r.type===b.BINARY_ACK){for(var u=t+1;e.charAt(++t)!=="-"&&t!=e.length;);var f=e.substring(u,t);if(f!=Number(f)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(f)}if(e.charAt(t+1)==="/"){for(var d=t+1;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(d,t)}else r.nsp="/";var m=e.charAt(t+1);if(m!==""&&Number(m)==m){for(var y=t+1;++t;){var g=e.charAt(t);if(g==null||Number(g)!=g){--t;break}if(t===e.length)break}r.id=Number(e.substring(y,t+1))}if(e.charAt(++t)){var w=this.tryParse(e.substr(t));if(!o.isPayloadValid(r.type,w))throw new Error("invalid payload");r.data=w}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case b.CONNECT:return Se(t);case b.DISCONNECT:return t===void 0;case b.CONNECT_ERROR:return typeof t=="string"||Se(t);case b.EVENT:case b.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ct.indexOf(t[0])===-1);case b.ACK:case b.BINARY_ACK:return Array.isArray(t)}}}]),o}(C),lt=function(){function n(c){s(this,n),this.packet=c,this.buffers=[],this.reconPack=c}return h(n,[{key:"takeBinaryData",value:function(c){if(this.buffers.push(c),this.buffers.length===this.reconPack.attachments){var o=at(this.reconPack,this.buffers);return this.finishedReconstruction(),o}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),n}(),ft=Object.freeze({__proto__:null,protocol:5,get PacketType(){return b},Encoder:ut,Decoder:ht});function R(n,c,o){return n.on(c,o),function(){n.off(c,o)}}var dt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ne=function(n){p(o,n);var c=O(o);function o(e,t,r){var u;return s(this,o),(u=c.call(this)).connected=!1,u.recovered=!1,u.receiveBuffer=[],u.sendBuffer=[],u._queue=[],u._queueSeq=0,u.ids=0,u.acks={},u.flags={},u.io=e,u.nsp=t,r&&r.auth&&(u.auth=r.auth),u._opts=l({},r),u.io._autoConnect&&u.open(),u}return h(o,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[R(e,"open",this.onopen.bind(this)),R(e,"packet",this.onpacket.bind(this)),R(e,"error",this.onerror.bind(this)),R(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(dt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,r=new Array(t>1?t-1:0),u=1;u<t;u++)r[u-1]=arguments[u];if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;var f={type:b.EVENT,data:r,options:{}};if(f.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){var d=this.ids++,m=r.pop();this._registerAckCallback(d,m),f.id=d}var y=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!y||!this.connected)||(this.connected?(this.notifyOutgoingListeners(f),this.packet(f)):this.sendBuffer.push(f)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var r,u=this,f=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(f!==void 0){var d=this.io.setTimeoutFn(function(){delete u.acks[e];for(var m=0;m<u.sendBuffer.length;m++)u.sendBuffer[m].id===e&&u.sendBuffer.splice(m,1);t.call(u,new Error("operation has timed out"))},f);this.acks[e]=function(){u.io.clearTimeoutFn(d);for(var m=arguments.length,y=new Array(m),g=0;g<m;g++)y[g]=arguments[g];t.apply(u,[null].concat(y))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,r=arguments.length,u=new Array(r>1?r-1:0),f=1;f<r;f++)u[f-1]=arguments[f];var d=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise(function(m,y){u.push(function(g,w){return d?g?y(g):m(w):m(g)}),t.emit.apply(t,[e].concat(u))})}},{key:"_addToQueue",value:function(e){var t,r=this;typeof e[e.length-1]=="function"&&(t=e.pop());var u={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:l({fromQueue:!0},this.flags)};e.push(function(f){if(u===r._queue[0]){if(f!==null)u.tryCount>r._opts.retries&&(r._queue.shift(),t&&t(f));else if(r._queue.shift(),t){for(var d=arguments.length,m=new Array(d>1?d-1:0),y=1;y<d;y++)m[y-1]=arguments[y];t.apply(void 0,[null].concat(m))}return u.pending=!1,r._drainQueue()}}),this._queue.push(u),this._drainQueue()}},{key:"_drainQueue",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.connected&&this._queue.length!==0){var t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;typeof this.auth=="function"?this.auth(function(t){e._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:b.CONNECT,data:this._pid?l({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case b.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case b.EVENT:case b.BINARY_EVENT:this.onevent(e);break;case b.ACK:case b.BINARY_ACK:this.onack(e);break;case b.DISCONNECT:this.ondisconnect();break;case b.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=le(this._anyListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e)}catch(u){r.e(u)}finally{r.f()}}S(v(o.prototype),"emit",this).apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,r=!1;return function(){if(!r){r=!0;for(var u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];t.packet({type:b.ACK,id:e,data:f})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach(function(t){return e.emitEvent(t)}),this.receiveBuffer=[],this.sendBuffer.forEach(function(t){e.notifyOutgoingListeners(t),e.packet(t)}),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach(function(e){return e()}),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:b.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,r=le(this._anyOutgoingListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e.data)}catch(u){r.e(u)}finally{r.f()}}}}]),o}(C);function I(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}I.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var c=Math.random(),o=Math.floor(c*this.jitter*n);n=1&Math.floor(10*c)?n+o:n-o}return 0|Math.min(n,this.max)},I.prototype.reset=function(){this.attempts=0},I.prototype.setMin=function(n){this.ms=n},I.prototype.setMax=function(n){this.max=n},I.prototype.setJitter=function(n){this.jitter=n};var ce=function(n){p(o,n);var c=O(o);function o(e,t){var r,u;s(this,o),(r=c.call(this)).nsps={},r.subs=[],e&&i(e)==="object"&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",r.opts=t,$(A(r),t),r.reconnection(t.reconnection!==!1),r.reconnectionAttempts(t.reconnectionAttempts||1/0),r.reconnectionDelay(t.reconnectionDelay||1e3),r.reconnectionDelayMax(t.reconnectionDelayMax||5e3),r.randomizationFactor((u=t.randomizationFactor)!==null&&u!==void 0?u:.5),r.backoff=new I({min:r.reconnectionDelay(),max:r.reconnectionDelayMax(),jitter:r.randomizationFactor()}),r.timeout(t.timeout==null?2e4:t.timeout),r._readyState="closed",r.uri=e;var f=t.parser||ft;return r.encoder=new f.Encoder,r.decoder=new f.Decoder,r._autoConnect=t.autoConnect!==!1,r._autoConnect&&r.open(),r}return h(o,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new se(this.uri,this.opts);var r=this.engine,u=this;this._readyState="opening",this.skipReconnect=!1;var f=R(r,"open",function(){u.onopen(),e&&e()}),d=function(w){t.cleanup(),t._readyState="closed",t.emitReserved("error",w),e?e(w):t.maybeReconnectOnOpen()},m=R(r,"error",d);if(this._timeout!==!1){var y=this._timeout,g=this.setTimeoutFn(function(){f(),d(new Error("timeout")),r.close()},y);this.opts.autoUnref&&g.unref(),this.subs.push(function(){t.clearTimeoutFn(g)})}return this.subs.push(f),this.subs.push(m),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(R(e,"ping",this.onping.bind(this)),R(e,"data",this.ondata.bind(this)),R(e,"error",this.onerror.bind(this)),R(e,"close",this.onclose.bind(this)),R(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}},{key:"ondecoded",value:function(e){var t=this;ne(function(){t.emitReserved("packet",e)},this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Ne(this,e,t),this.nsps[e]=r),r}},{key:"_destroy",value:function(e){for(var t=0,r=Object.keys(this.nsps);t<r.length;t++){var u=r[t];if(this.nsps[u].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),r=0;r<t.length;r++)this.engine.write(t[r],e.options)}},{key:"cleanup",value:function(){this.subs.forEach(function(e){return e()}),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var r=this.backoff.duration();this._reconnecting=!0;var u=this.setTimeoutFn(function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open(function(f){f?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",f)):t.onreconnect()}))},r);this.opts.autoUnref&&u.unref(),this.subs.push(function(){e.clearTimeoutFn(u)})}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),o}(C),D={};function H(n,c){i(n)==="object"&&(c=n,n=void 0);var o,e=function(d){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",y=arguments.length>2?arguments[2]:void 0,g=d;y=y||typeof location<"u"&&location,d==null&&(d=y.protocol+"//"+y.host),typeof d=="string"&&(d.charAt(0)==="/"&&(d=d.charAt(1)==="/"?y.protocol+d:y.host+d),/^(https?|wss?):\/\//.test(d)||(d=y!==void 0?y.protocol+"//"+d:"https://"+d),g=re(d)),g.port||(/^(http|ws)$/.test(g.protocol)?g.port="80":/^(http|ws)s$/.test(g.protocol)&&(g.port="443")),g.path=g.path||"/";var w=g.host.indexOf(":")!==-1?"["+g.host+"]":g.host;return g.id=g.protocol+"://"+w+":"+g.port+m,g.href=g.protocol+"://"+w+(y&&y.port===g.port?"":":"+g.port),g}(n,(c=c||{}).path||"/socket.io"),t=e.source,r=e.id,u=e.path,f=D[r]&&u in D[r].nsps;return c.forceNew||c["force new connection"]||c.multiplex===!1||f?o=new ce(t,c):(D[r]||(D[r]=new ce(t,c)),o=D[r]),e.query&&!c.query&&(c.query=e.queryKey),o.socket(e.path,c)}return l(H,{Manager:ce,Socket:Ne,io:H,connect:H}),H});io;function Ot(i){return/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(i)}class Tt extends q{constructor(s){super(),this.manager=s,this.games=[null,null,null],this.fetchRooms(),setInterval(()=>{this.fetchRooms()},1e4)}async fetchRooms(){const s=await this.manager.client.fetchRooms();this.games=s.concat(new Array(6).fill(null)).slice(0,3),this.rerender()}create(){this.element=document.createElement("div");const s=this.games.slice(0,3).map(a=>{const h=document.createElement("div");a!==null?h.style.cursor="pointer":h.style.opacity=.5,h.className="live-game",a!==null&&(h.onclick=()=>{document.body.firstChild.children[0].remove(),this.manager.games.join(a.id)});const l=document.createElement("span");l.className="name",l.textContent=a!==null?`Partie ${a.id.slice(-3)}`:"";const p=document.createElement("div");p.className="teams";const v=document.createElement("div"),E=document.createElement("span");E.textContent=a==null?void 0:a.playerCountByTeam[0],v.appendChild(E);const _=document.createElement("div"),k=document.createElement("span");return k.textContent=a==null?void 0:a.playerCountByTeam[1],_.appendChild(k),p.append(v,_),a!==null&&h.append(l,p),h});return this.element.append(...s),this.element}}class qe extends je{constructor(s){super(),this.manager=s}render(){document.title="Nom de code",history.replaceState(null,"","/");const s=document.createElement("div");s.id="home";const a=document.createElement("div");a.id="home-header";const h=document.createElement("span");h.id="home-title",h.textContent="Nom de code :";const l=document.createElement("div");l.id="home-subtitle-container";const p=document.createElement("span");p.className="home-subtitle",p.textContent="NIGHT";const v=document.createElement("span");v.className="home-subtitle",v.textContent="CLUB",l.append(p,v),a.append(h,l);const E=document.createElement("div");E.id="games-container";const _=document.createElement("div"),k=document.createElement("div");k.id="create-game-cta",k.onclick=()=>{s.remove(),this.manager.games.create()};const T=document.createElement("span");T.textContent="Crer une partie",k.appendChild(T),_.append(k);const A=new Tt(this.manager).create();return E.append(_,A),s.append(E),s}}let Me=class extends q{constructor(s,a){super(),this.game=s,this.team=a,this.game.socket.on("player-joined",h=>{this.game.add(h),this.rerender()}),this.game.socket.on("player-list",h=>{this.game.add(h),this.rerender()}),this.game.socket.on("player-leaved",h=>{this.game.add(h),this.rerender()}),this.game.socket.on("player-updated",h=>{const l=this.game.players.get(h.id);l.role=h.role,l.team=h.team,l.nickname=h.nickname,this.rerender()})}create(){this.element=document.createElement("div"),this.element.className="team";const s=document.createElement("span");s.className="team-title",s.textContent=`EQUIPE ${this.team?"ROUGE":"BLEUE"}`;const a=document.createElement("div");a.className="list-container";const[h,l]=[0,1].map(p=>{const v=document.createElement("span");v.style.cursor="pointer",v.className="team-subtitle",v.textContent=p?"ESPIONS":"AGENTS",v.onclick=()=>this.game.emit("update-player",{team:this.team,role:p});const E=document.createElement("div");E.className="list";const _=this.game.players.map(k=>{if(k.team!==this.team||k.role!==p)return[];const T=document.createElement("div"),A=document.createElement("span");return A.className="username",A.textContent=k.nickname||k.username,T.append(A),T});return E.append(v,..._),E});return a.append(h,l),this.element.append(s,a),this.element}};class xt extends q{constructor(s){super(),this.game=s,this.team=0}create(){const s=document.createElement("div");s.id="left-panel";const a=document.createElement("div");a.className="up-banner";const h=document.createElement("div");h.className="options";const l=document.createElement("span");l.onclick=()=>{this.game.socket.close();const v=new qe(this.game.manager.manager);document.body.firstChild.children[0].replaceWith(v.render())},l.textContent="",h.appendChild(l),a.appendChild(h);const p=new Me(this.game,this.team).create();return s.append(a,p),s}}class Rt{constructor({width:s,height:a}){this.element=document.createElement("div"),this.element.id="modal",this.element.style.width=`${s}px`,this.element.style.height=`${a}px`,this.mask=document.createElement("div"),this.mask.id="mask",this.check=h=>{this.element.contains(h.target)||this.open()}}open(s){s?(document.body.append(this.element,this.mask),s.stopPropagation(),window.addEventListener("click",this.check)):(window.removeEventListener("click",this.check),this.element.remove(),this.mask.remove())}}class St extends Rt{constructor(s){super({width:550,height:100}),this.game=s,this.element.className="new-username-modal";const a=document.createElement("span");a.textContent="NOUVEAU PSEUDONYME :";const h=document.createElement("div");h.id="new-username-container";const l=document.createElement("input");l.spellcheck=!1,l.id="new-username-input";const p=document.createElement("div");p.id="change-username-cta",p.onclick=()=>{this.open(),this.game.emit("update-player",{nickname:l.value})};const v=document.createElement("span");v.textContent="Changer",p.appendChild(v),h.append(l,p),this.element.append(a,h)}}class Nt extends q{constructor(s){super(),this.game=s,this.team=1}create(){const s=document.createElement("div");s.id="right-panel";const a=document.createElement("div");a.className="up-banner";const h=document.createElement("div");h.className="options";const l=new St(this.game),p=document.createElement("span");p.onclick=_=>l.open(_),p.textContent="";const v=document.createElement("span");v.textContent="",h.append(p,v),a.appendChild(h);const E=new Me(this.game,this.team).create();return s.append(a,E),s}}class Bt extends q{constructor(s){super(),this.game=s}create(s){const a=document.createElement("div");a.id="clue-count-selector",a.style.visibility="hidden";const h=Array.from([...Array(10).keys(),""],l=>{const p=document.createElement("div");p.className="number-container";const v=document.createElement("span");return v.className="number",v.textContent=l,p.onclick=()=>{s.textContent=l,a.style.visibility="hidden"},p.appendChild(v),p});return a.append(...h),a}}class Lt extends q{constructor(s){super(),this.game=s,this.game.socket.on("game-joined",a=>{this.game.started=a.started,this.game.turn=a.turn,this.rerender()}),this.game.socket.on("game-started",a=>{this.game.started=!0,this.game.turn=a.turn,this.rerender()}),this.game.socket.on("player-updated",a=>{a.id===this.game.playerId&&this.rerender()}),this.game.socket.on("clue-forwarded",a=>{this.game.teams[this.game.turn.team].clues.set(this.game.teams[this.game.turn.team].size,{word:a.word,count:a.count,relatedWords:a.relatedWords}),this.game.turn.role^=!0,this.rerender()}),this.game.socket.on("clue-list",a=>{this.game.clues.add(a),this.rerender()}),this.game.socket.on("card-revealed",a=>{(a.team!==this.game.turn.team||a.clueRemainder===0)&&(this.game.turn.team^=!0,this.game.turn.role^=!0),this.rerender()})}create(){this.element=document.createElement("div"),this.element.id="bottom-board";const s=document.createElement("div");s.id="clue-bar";const a=document.createElement("div");a.id="clue-count-container",a.onclick=()=>{a.classList.contains("disabled")||(l.style.visibility=l.style.visibility==="hidden"?"visible":"hidden")},this.game.selectedCards.size&&a.classList.add("disabled");const h=document.createElement("span");h.id="clue-count-text",h.textContent=this.game.selectedCards.size?this.game.selectedCards.size:"-",a.appendChild(h);const l=new Bt(this.game).create(h),p=document.createElement("input");p.spellcheck=!1,p.style.textTransform="uppercase",p.id="clue-word-input",p.oninput=()=>{};const v=document.createElement("div");v.id="give-clue-cta",v.className="cta",v.onclick=()=>{this.game.emit("give-clue",{word:p.value.toUpperCase(),count:isNaN(h.textContent)?h.textContent:parseInt(h.textContent)})};const E=document.createElement("span");E.textContent="Transmettre",v.appendChild(E),s.append(l,a,p,v);const _=document.createElement("div");_.id="clue-word-container";const k=document.createElement("span");k.textContent=this.game.clues.size?this.game.clues.last().word:"???";const T=document.createElement("span");T.textContent=this.game.clues.size?this.game.clues.last().count:"?",_.append(k,T);const A=document.createElement("div");A.id="start-game-cta",A.className="cta",A.onclick=()=>{this.game.emit("start-game")};const O=document.createElement("span");return O.textContent="Lancer la partie",A.append(O),this.game.turn.role===0&&this.element.appendChild(_),this.game.turn.role===1&&this.game.turn.team===this.game.player.team&&this.game.turn.role===this.game.player.role&&this.element.appendChild(s),this.game.started===!1&&this.element.appendChild(A),this.element}}class Le extends je{constructor(s,a){super(),this.manager=s,this.game=a,this.app=document.body.firstChild,this.element=this.render(),this.app.appendChild(this.element)}render(){const s=document.createElement("div");s.id="game";const a=new xt(this.game).create(),h=document.createElement("div");h.id="middle-panel",this.board=new vt(this.game,{size:5}).create();const l=new Lt(this.game).create();h.append(this.board,l);const p=new Nt(this.game).create();return s.append(a,h,p),s}}class Pt{get baseURL(){return location.hostname==="localhost"?"http://localhost:8889":`https://${location.hostname}:8889`}fetchRooms(){const s="/rooms";return fetch(this.baseURL+s).then(a=>a.json())}async login(s,a){const h="/login";return await(await fetch(this.baseURL+h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:a})})).json()}}class jt{constructor(s,a){this.id=a,Object.defineProperty(this,"game",{value:s})}get members(){return this.game.players.filter(s=>s.team===this.id)}get clues(){return this.game.clues.filter(s=>s.team===this.id)}get words(){return this.game.words.filter(s=>s.team===this.id)}}class qt extends B{}class Mt extends B{constructor(s=[]){super(),this.add(s)}add(s){this.clear(),s.forEach(a=>this.set(a.id,a))}}class It extends B{constructor(){super()}add(s){this.clear(),s.forEach(a=>this.set(this.size+1,a))}}class Pe{constructor(s,a,h={teamCount:2}){Y(this,"started",null);Y(this,"words",null);Y(this,"turn",{team:null,role:null});this.manager=s,this.socket=a,a.onAny((l,p)=>this.handle({name:l,data:p})),this.players=new qt,this.teams=Array.from({length:h.teamCount},(l,p)=>new jt(this,p)),this.clues=new It,this.words=new Mt,this.selectedCards=[],this.reversedCards=[]}emit(...s){this.socket.emit(...s)}add(s){Array.isArray(s)||(s=[s]),s.forEach(a=>this.players.set(a.id,a))}remove(s){Array.isArray(s)||(s=[s]),s.forEach(a=>this.players.delete(a.id))}get player(){return this.players.get(this.playerId)||{}}handle(s){}}class Ut extends B{constructor(s){super(),Object.defineProperty(this,"manager",{value:s})}get socketURL(){return`${location.protocol==="http:"?"ws":"wss"}://${location.hostname}:8888/play`}create(){const s=io(this.socketURL);s.emit("create-game");const a=new Pe(this,s);new Le(this,a)}join(s){const a=io(this.socketURL);a.emit("join-game",{id:s});const h=new Pe(this,a);new Le(this,h)}}class Dt{constructor(){this.client=new Pt,this.games=new Ut(this)}}document.oncontextmenu=i=>i.preventDefault();window.onload=()=>new Ft().launch();class Ft{constructor(){this.manager=new Dt}launch(){const s=document.createElement("div");s.id="app",document.body.appendChild(s);const a=location.pathname.substring(1);if(Ot(a))this.manager.games.join(a);else{const h=new qe(this.manager);s.appendChild(h.render())}}}});export default zt();
